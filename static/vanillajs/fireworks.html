<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <style type="text/css">
  body {
    background-color: #ffffff;
    font-family: Monospace;
		margin: 0px;
		overflow: hidden;
  }
  </style>
</head>

<body>
  <canvas id="myCanvas"></canvas>
  <script src="proton.min.js"></script>
  <script>
    var canvas;
    var context;
    var proton;
    var renderer;
    var emitter;

    main();
    function main() {
      canvas = document.getElementById('myCanvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight * 1.2;
      canvas.style.background = '0000000';
      context = canvas.getContext('2d');
      
      createProton();
      tick();
    }

    function createProton(image) {
      proton = new Proton;
      emitter = new Proton.Emitter();
      emitter.rate = new Proton.Rate(new Proton.Span(.75, 1.5), 1);

      emitter.addInitialize(new Proton.Mass(1));
      emitter.addInitialize(new Proton.Radius(.9, 1.3));
      emitter.addInitialize(new Proton.P(new Proton.LineZone(100, 0, canvas.width - 100, 0)));
      emitter.addInitialize(new Proton.Life(1, 1.5));
      emitter.addInitialize(new Proton.V(new Proton.Span(3.4,5.9), new Proton.Span(180, 180), 'polar'));

      emitter.addBehaviour(new Proton.Gravity(-3.3));
      emitter.addBehaviour(new Proton.Color('0000000', '000000'));
      emitter.addBehaviour(new Proton.Alpha(1,0));
      emitter.emit();
      proton.addEmitter(emitter);

      renderer = new Proton.CanvasRenderer(canvas);
      proton.addRenderer(renderer);

      ////NOTICE :you can only use two emitters do this effect.In this demo I use more emitters want to test the emtter's life
      proton.addEventListener(Proton.PARTICLE_DEAD, function(particle) {
        let p = Math.random();
        if (p< .33) {
          createFirstEmitter(particle);
        } else if (p < 0.73) {
          createSecendEmitter(particle);
        } else {
          createThirdEmitter(particle);
        }
      });
    }

    function createFirstEmitter(particle) {
      var subemitter = new Proton.Emitter();
      subemitter.rate = new Proton.Rate(new Proton.Span(300, 500), 1);
      subemitter.addInitialize(new Proton.Mass(1));
      subemitter.addInitialize(new Proton.Radius(0.5, 1));
      subemitter.addInitialize(new Proton.Life(2, 4));
      subemitter.addInitialize(new Proton.V(new Proton.Span(0.95, 1.45), new Proton.Span(0, 360), 'polar'));

      subemitter.addBehaviour(new Proton.RandomDrift(6, 9, .5));
      subemitter.addBehaviour(new Proton.Cyclone(new Proton.Span(-3, 3), 5));
      subemitter.addBehaviour(new Proton.Alpha(1, 0));
      subemitter.addBehaviour(new Proton.Scale(1, .1));
      subemitter.addBehaviour(new Proton.Color('random'));
      subemitter.addBehaviour(new Proton.Gravity(1.7));

      subemitter.p.x = particle.p.x;
      subemitter.p.y = particle.p.y;
      subemitter.emit('once', true);
      proton.addEmitter(subemitter);
    }

    function createSecendEmitter(particle) {
      var subemitter = new Proton.Emitter();
      subemitter.rate = new Proton.Rate(new Proton.Span(150, 220), 1);

      subemitter.addInitialize(new Proton.Mass(1));
      subemitter.addInitialize(new Proton.Radius(1, 2));
      subemitter.addInitialize(new Proton.Life(2, 4));
      subemitter.addInitialize(new Proton.V([1.6, 2.5], new Proton.Span(0, 360), 'polar'));

      subemitter.addBehaviour(new Proton.Alpha(1, 0));
      subemitter.addBehaviour(new Proton.Scale(1, .1));
      subemitter.addBehaviour(new Proton.RandomDrift(2, 4, .05));
      subemitter.addBehaviour(new Proton.Color('random'));
      subemitter.addBehaviour(new Proton.Gravity(1.5));

      subemitter.p.x = particle.p.x;
      subemitter.p.y = particle.p.y;
      subemitter.emit('once', true);
      proton.addEmitter(subemitter);
    }

    function createThirdEmitter(particle) { 
      var subemitter = new Proton.Emitter();
      subemitter.rate = new Proton.Rate(new Proton.Span(400, 600), 1);
      subemitter.addInitialize(new Proton.Mass(1));
      subemitter.addInitialize(new Proton.Radius(1.5, 2.5));
      subemitter.addInitialize(new Proton.Life(2, 4));
      subemitter.addInitialize(new Proton.V([0.75, 2.5, 4], new Proton.Span(0, 360), 'polar'));

      subemitter.addBehaviour(new Proton.RandomDrift(6, 9, .5));
      subemitter.addBehaviour(new Proton.Alpha(1, 0));
      subemitter.addBehaviour(new Proton.Scale(1, .1));
      subemitter.addBehaviour(new Proton.Color('random'));
      subemitter.addBehaviour(new Proton.Gravity(1.7));
      subemitter.addBehaviour(new Proton.Cyclone(Proton.getSpan(-.5, .5), 2));

      subemitter.p.x = particle.p.x;
      subemitter.p.y = particle.p.y;
      subemitter.emit('once', true);
      proton.addEmitter(subemitter);
    }

    // make canvas responsive without clearing
    function resize() {
        var W = canvas.width, H = canvas.height
        let temp = context.getImageData(0,0,W,H)
        context.canvas.width = window.innerWidth;
        W = canvas.width, H = canvas.height
        context.putImageData(temp,0,0)
    }

    window.onresize = resize; 

    function tick() {
      requestAnimationFrame(tick);

      canvas.style.background = 'ffffff';
    //   canvas.width = window.innerWidth;
    //   resize();
      // could make canvas size responsive, but this clears the 
    //   canvas.height = window.innerHeight;
    //   canvas.width = window.innerWidth;
      renderer.onProtonUpdate = function() {
        context.fillStyle = "rgba(255, 255, 255, 0.12)";
        context.fillRect(0, 0, canvas.width, canvas.height);
      };
      
      proton.update();
      // stats.end();
    }
  </script>
</body>

</html>